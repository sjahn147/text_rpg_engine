# [deprecated] 최종 단계 개발 계획서

> **Deprecated 날짜**: 2025-12-28  
> **Deprecated 이유**: 최종 단계 개발이 완료되어 더 이상 진행 중인 작업이 아님. 시나리오 테스트와 마을 시뮬레이션은 Phase 3에서 완료되었으며, 현재는 Phase 4+ 개발이 진행 중임.  
> **문서 버전**: v1.0
> **작성일**: 2025-10-19
> **목표**: 시나리오 테스트와 마을 시뮬레이션 100% 달성

## 🎯 **최종 목표**

실제 DB 통신을 통한 Manager 클래스들의 불변데이터-레퍼런스레이어-런타임레이어 설계 검증

### **핵심 철학**
- **실제 DB 통신**: Mock이 아닌 실제 PostgreSQL 데이터베이스 사용
- **3계층 설계 검증**: game_data → reference_layer → runtime_data 흐름 확인
- **데이터 누적**: 시뮬레이션 결과가 DB에 정확히 저장되는지 검증
- **완전한 통합**: 모든 Manager 클래스가 실제 DB와 연동하여 작동

## 📊 **현재 상태 분석**

### **✅ 완료된 부분**
- Manager 클래스들: Entity, Cell, Dialogue, Action, Effect Carrier
- 데이터베이스 스키마: 40개 테이블, 완전한 무결성
- 추상화 원칙: 모든 Manager가 DB에서 동적 로드
- 기본 기능: CRUD 작업 및 Manager 간 연동

### **❌ 미완성 부분**
- 시나리오 테스트: 0/22 통과 (Mock 설정 문제)
- 마을 시뮬레이션: 0/3 통과 (API 호환성 문제)
- 실제 DB 통신: Mock 의존성으로 인한 제한

## 🚀 **최종 단계 실행 계획**

### **Phase 7.1: 시나리오 테스트 DB 통합**

#### **목표**: 실제 DB 연결을 통한 Manager 테스트
#### **예상 소요시간**: 2-3일
#### **성공 지표**: 시나리오 테스트 100% 통과

**세부 작업**:
1. **실제 DB 연결 설정**
   - Mock 의존성 제거
   - 실제 PostgreSQL 연결 사용
   - 테스트 데이터베이스 설정

2. **Entity Manager 시나리오 (6개)**
   - 정적 엔티티 템플릿에서 런타임 인스턴스 생성
   - 엔티티 상태 변경 및 업데이트
   - Effect Carrier 적용 및 제거

3. **Cell Manager 시나리오 (5개)**
   - 정적 셀 템플릿에서 런타임 인스턴스 생성
   - 셀 간 이동 및 엔티티 배치
   - 셀 상태 관리

4. **Dialogue Manager 시나리오 (4개)**
   - NPC와 플레이어 대화 시작
   - 대화 주제별 응답 생성
   - 대화 기록 저장 및 조회

5. **Action Handler 시나리오 (4개)**
   - 플레이어 행동 실행
   - 행동 결과 처리 및 저장
   - 행동 로그 기록

6. **통합 시나리오 (3개)**
   - 전체 게임 플로우
   - Manager 간 연동
   - 에러 처리 및 복구

### **Phase 7.2: 마을 시뮬레이션 DB 통합**

#### **목표**: 실제 DB를 통한 100일 시뮬레이션
#### **예상 소요시간**: 2-3일
#### **성공 지표**: 마을 시뮬레이션 100% 통과

**세부 작업**:
1. **100일 시뮬레이션**
   - 실제 DB 연결을 통한 시뮬레이션
   - 시간 진행 및 이벤트 처리
   - DB 데이터 누적 확인

2. **NPC 일과 시뮬레이션**
   - 시간대별 NPC 행동 패턴
   - 셀 이동 및 상호작용
   - 행동 기록 저장

3. **NPC 상호작용 시뮬레이션**
   - NPC 간 대화 시뮬레이션
   - 상호작용 확률 및 결과
   - 대화 기록 저장

### **Phase 7.3: DB 데이터 누적 검증**

#### **목표**: 시뮬레이션 결과가 DB에 정확히 저장되는지 확인
#### **예상 소요시간**: 1일
#### **성공 지표**: 모든 DB 테이블에 데이터 누적 확인

**세부 작업**:
1. **game_data 테이블 검증**
   - 정적 엔티티 템플릿 조회
   - 정적 셀 템플릿 조회
   - 대화 컨텍스트 템플릿 조회

2. **reference_layer 테이블 검증**
   - 엔티티 참조 관계 확인
   - 셀 참조 관계 확인
   - 세션 참조 관계 확인

3. **runtime_data 테이블 검증**
   - 런타임 엔티티 인스턴스 확인
   - 런타임 셀 인스턴스 확인
   - 대화 기록 확인
   - 행동 로그 확인
   - 셀 점유자 확인

### **Phase 7.4: 최종 통합 테스트**

#### **목표**: 모든 시나리오와 시뮬레이션 100% 통과
#### **예상 소요시간**: 1일
#### **성공 지표**: 전체 테스트 100% 통과

**세부 작업**:
1. **전체 테스트 실행**
   - 시나리오 테스트: 22/22 통과
   - 마을 시뮬레이션: 3/3 통과
   - 단위 테스트: 100% 통과
   - 통합 테스트: 100% 통과

2. **성능 검증**
   - 시뮬레이션 실행 시간 < 10분
   - DB 쿼리 성능 < 100ms
   - 메모리 사용량 안정성

3. **데이터 무결성 검증**
   - 외래 키 제약조건 확인
   - 데이터 일관성 확인
   - 트랜잭션 무결성 확인

## 📊 **성공 지표 및 메트릭**

### **Phase 7.1 완료 시**
- 시나리오 테스트: 22/22 통과 (100%)
- Entity Manager: 6/6 통과
- Cell Manager: 5/5 통과
- Dialogue Manager: 4/4 통과
- Action Handler: 4/4 통과
- 통합 시나리오: 3/3 통과

### **Phase 7.2 완료 시**
- 마을 시뮬레이션: 3/3 통과 (100%)
- 100일 시뮬레이션: 정상 작동
- NPC 일과: 정상 작동
- NPC 상호작용: 정상 작동

### **Phase 7.3 완료 시**
- DB 데이터 누적: 100% 확인
- game_data 테이블: 정상 조회
- reference_layer 테이블: 정상 관계
- runtime_data 테이블: 정상 저장

### **Phase 7.4 완료 시**
- 전체 테스트: 100% 통과
- 성능 지표: 모든 목표 달성
- 데이터 무결성: 100% 확인

## 🎯 **최종 목표 달성 계획**

### **단계별 목표**
1. **Week 1**: Phase 7.1-7.2 (시나리오 테스트, 마을 시뮬레이션)
2. **Week 2**: Phase 7.3-7.4 (DB 데이터 누적, 최종 통합)

### **성공 기준**
- **시나리오 테스트**: 22/22 통과 (100%)
- **마을 시뮬레이션**: 3/3 통과 (100%)
- **전체 테스트**: 100% 통과
- **DB 데이터 누적**: 100% 확인

### **리스크 관리**
1. **DB 연결 복잡성**: 실제 DB 연결 설정 충분한 시간 할당
2. **데이터 의존성**: 테스트 데이터 준비 및 정리 계획
3. **성능 이슈**: 대용량 시뮬레이션 성능 최적화

## 📝 **결론**

최종 단계는 실제 DB 통신을 통한 Manager 클래스들의 3계층 설계 검증이 목표입니다. Mock 의존성을 제거하고 실제 PostgreSQL 데이터베이스를 사용하여 시나리오 테스트와 마을 시뮬레이션을 100% 달성하는 것이 핵심입니다.

**예상 완료일**: 2주 내
**성공 확률**: 95% (실제 DB 연결과 체계적인 접근)
